{% extends "accounts/base-auth-form.html" %}
{% load static %}
{% load i18n %}

{% block auth_title %}Check Your Email{% endblock %}
{% block auth_subtitle %}We've sent you a confirmation link{% endblock %}

{% block auth_content %}
<div class="text-center mb-4">
    <div class="mb-4">
        <i class="fas fa-envelope-open-text" style="font-size: 48px; color: #5E72E4;"></i>
    </div>
    <h5 class="mb-3">Almost there!</h5>
    <p class="text-muted">
        We've sent a confirmation email to <strong>{{ email }}</strong>. 
        Please check your inbox and click the confirmation link to complete your registration.
    </p>
    <div class="alert alert-info" role="alert">
        <i class="fas fa-info-circle"></i>
        The confirmation link will expire in 24 hours.
    </div>
</div>

<div class="mt-4">
    <p class="text-muted text-center mb-0">Didn't receive the email?</p>
    <div class="d-flex justify-content-center mt-2">
        <a href="#" class="text-primary" id="resendButton">Resend confirmation email</a>
    </div>
    <div id="resendMessage" class="text-center mt-2" style="display: none;"></div>
</div>
{% endblock %}

{% block auth_footer %}
<a href="{% url 'login' %}" class="text-muted">
    <i class="fas fa-arrow-left"></i> Back to login
</a>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('resendButton').addEventListener('click', function(e) {
    e.preventDefault();
    
    // Disable the button
    this.style.pointerEvents = 'none';
    this.style.opacity = '0.5';
    
    fetch('{% url "resend_confirmation" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: 'email={{ email }}'
    })
    .then(response => response.json())
    .then(data => {
        const messageDiv = document.getElementById('resendMessage');
        if (data.message) {
            messageDiv.className = 'text-success';
            messageDiv.textContent = data.message;
        } else {
            messageDiv.className = 'text-danger';
            messageDiv.textContent = data.error;
        }
        messageDiv.style.display = 'block';
        
        // Re-enable the button after 60 seconds
        setTimeout(() => {
            this.style.pointerEvents = 'auto';
            this.style.opacity = '1';
        }, 60000);
    })
    .catch(error => {
        const messageDiv = document.getElementById('resendMessage');
        messageDiv.className = 'text-danger';
        messageDiv.textContent = 'Failed to resend confirmation email. Please try again.';
        messageDiv.style.display = 'block';
        
        // Re-enable the button
        this.style.pointerEvents = 'auto';
        this.style.opacity = '1';
    });
});
</script>
{% endblock %}
