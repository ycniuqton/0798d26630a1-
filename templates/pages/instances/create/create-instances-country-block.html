<style>
    .iframe-container {display: flex; width: 100%; height: 100%; flex-direction: column; overflow: hidden;}
    .parent-fit { flex-grow: 1; border: none; margin: 0; padding: 0; height: 100vh; }
    .country-selection .nav-tabs .nav-link.active {
        background-color: #f8f9fa;
    }
    .country-card {
        border: 1px solid #ddd;
        cursor: pointer;
        transition: transform 0.2s;
    }
    .country-card:hover {
        transform: scale(1.05);
    }
    .country-card.sold-out {
        opacity: 0.6;
    }
    .country-card.sold-out:hover {
        transform: none;
    }
    .country-card.selected {
        border: 2px solid #007bff;
        box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
    }
</style>


<div class="country-selection">
    <h5>Location</h5>
    <ul class="nav nav-tabs" id="countryTab" role="tablist">
        {% for region in regions %}
        <li class="nav-item d-flex align-items-center" role="presentation">
            <a class="nav-link {% if forloop.first %}active{% endif %} {% if region.status == 'off' %}disabled{% else %}fw-bold{% endif %}"
               id="{{ region.name|slugify }}-tab"
               data-bs-toggle="tab"
               href="#{{ region.name|slugify }}"
               role="tab"
               aria-controls="{{ region.name|slugify }}"
               aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
               {% if region.status == 'off' %}aria-disabled="true"{% endif %}>
               {{ region.name }}
            </a>
            {% if region.status == 'off' %}
            <span class="badge bg-danger ms-2">100%</span>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
    <div class="tab-content mt-3" id="countryTabContent">
        {% for region in regions %}
        <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="{{ region.name|slugify }}"
             role="tabpanel" aria-labelledby="{{ region.name|slugify }}-tab"
             {% if region.status == 'off' %}style="pointer-events: none; opacity: 0.5;"{% endif %}>
            <div class="row">
                {% for location in locations %}
                {% if region.name == "ALL" or location.region == region.name %}
                <div class="col-6 col-md-4 col-lg-3 mb-3">
                    <div class="card country-card {% if location.status == 'off' %}sold-out{% endif %}"
                         data-name="{{ location.name }}" data-country="{{ location.country }}" group-id="{{ location.group_id }}"
                         {% if location.status == 'off' %}style="pointer-events: none; opacity: 0.5;"{% endif %}>
                        <div class="card-body text-center">
                            <img src="/api/static/flags/{{ location.country_short }}" alt="{{ location.name }}" class="mb-2">
                            <h6>{{ location.name }}</h6>
                            <p class="text-muted">{{ location.country }}</p>
                            {% if location.status == 'off' %}
                            <span class="badge bg-danger mt-2">100%</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>





<script>
    document.addEventListener('DOMContentLoaded', function() {
        var triggerTabList = [].slice.call(document.querySelectorAll('#countryTab a'));
        triggerTabList.forEach(function (triggerEl) {
            var tabTrigger = new bootstrap.Tab(triggerEl);

            triggerEl.addEventListener('click', function (event) {
                event.preventDefault();
                tabTrigger.show();
            });
        });

        // Handle card selection
        var countryCards = document.querySelectorAll('.country-card');

        countryCards.forEach(function(card) {
            card.addEventListener('click', function() {
                // Deselect all other cards
                countryCards.forEach(function(otherCard) {
                    otherCard.classList.remove('selected');
                });

                // Select the clicked card
                card.classList.add('selected');

                // Update vpsConfiguration
                vpsConfiguration.location = {
                    name: card.getAttribute('data-name'),
                    country: card.getAttribute('data-country'),
                    id: card.getAttribute('group-id')
                };

                // Trigger configuration update
                document.getElementById('config_updated').value = 'true';
                document.getElementById('config_updated').dispatchEvent(new Event('change'));
            });
        });
    });
</script>
