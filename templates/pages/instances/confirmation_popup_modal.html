<!-- Confirmation Popup Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">Action Confirmation</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage">Are you sure you want to perform this action?</p>
                <table class="table">
                    <thead>
                    <tr>
                        <th>Instance Name</th>
                    </tr>
                    </thead>
                    <tbody id="selectedInstancesList">
                    <!-- Selected instances will be listed here -->
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmAction">Confirm</button>
            </div>
        </div>
    </div>
</div>




<script>
    // Handle action
        function handleAction(action) {
            var selectedInstances = document.querySelectorAll('.instance-checkbox:checked');
            if (selectedInstances.length === 0) {
                alert('Please select at least one instance.');
                return;
            }

            var selectedInstanceIds = [];
            var selectedInstanceNames = [];
            selectedInstances.forEach(function(instance) {
                selectedInstanceIds.push(instance.getAttribute('data-instance-id'));
                selectedInstanceNames.push(instance.closest('tr').children[1].textContent);
            });

            // Show confirmation modal
            var confirmationMessage = `Are you sure you want to ${action.toLowerCase()} the selected instances?`;
            document.getElementById('confirmationModalLabel').textContent = `${action} Confirmation`;
            document.getElementById('confirmationMessage').textContent = confirmationMessage;

            // Populate selected instances in modal
            var selectedInstancesList = document.getElementById('selectedInstancesList');
            selectedInstancesList.innerHTML = '';
            selectedInstanceNames.forEach(function(name) {
                var row = document.createElement('tr');
                var cell = document.createElement('td');
                cell.textContent = name;
                row.appendChild(cell);
                selectedInstancesList.appendChild(row);
            });

            // Show modal
            $('#confirmationModal').modal('show');

            // Handle confirm action
            document.getElementById('confirmAction').onclick = function() {
                $('#confirmationModal').modal('hide');

                // Make API call
                fetch(`/api/vps/${action.toLowerCase()}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({ instance_ids: selectedInstanceIds })
                })
                .then(response => {
                    if (response.ok) {
                        alert(`Instances ${action.toLowerCase()}ed successfully!`);
                        location.reload();
                    } else {
                        alert(`Failed to ${action.toLowerCase()} instances.`);
                    }
                })
                .catch(error => console.error('Error:', error));
            };
        }

</script>